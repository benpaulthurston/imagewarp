from PIL import Image

blank = Image.new("RGB",[800,800])
mona = Image.open("warp.png")



y = [[[0, 799],[400, 799],[799,799]],
     [[0,400], [400, 400],[799, 400]],
     [[0, 0],[400, 0], [799, 0]]]
x = [[[200, 480],[388, 538],[563,540]],
     [[199,320],[416,366],[611,380]],
     [[266,166], [402, 233],[560,214]]]


def w(d, s, t, i):
    return s**2*t**2*(d[1][1][i]-(1/2)*d[0][1][i]+(1/4)*d[0][2][i]-(1/2)*d[1][2][i]+(1/4)*d[2][2][i]-(1/2)*d[2][1][i]-(1/2)*d[1][0][i]+(1/4)*d[2][0][i]+(1/4)*d[0][0][i])+s**2*t*((1/2)*d[0][1][i]-(1/4)*d[0][2][i]+(1/4)*d[2][2][i]-(1/2)*d[2][1][i]+(1/4)*d[2][0][i]-(1/4)*d[0][0][i])+s*t**2*((1/2)*d[1][0][i]-(1/4)*d[2][0][i]+(1/4)*d[0][2][i]-(1/2)*d[1][2][i]+(1/4)*d[2][2][i]-(1/4)*d[0][0][i])+s**2*(-d[1][1][i]+(1/2)*d[1][0][i]+(1/2)*d[1][2][i])+s*t*((1/4)*d[0][0][i]-(1/4)*d[0][2][i]-(1/4)*d[2][0][i]+(1/4)*d[2][2][i])+t**2*(-d[1][1][i]+(1/2)*d[0][1][i]+(1/2)*d[2][1][i])+s*(-(1/2)*d[1][0][i]+(1/2)*d[1][2][i])+t*(-(1/2)*d[0][1][i]+(1/2)*d[2][1][i])+d[1][1][i]

for i in range(0, 1000):
    for j in range(0, 1000):
        try:
            s = i/500-1
            t = j/500-1
            r,g,b=mona.getpixel((w(x, s, t, 0), w(x, s, t, 1)))
            blank.putpixel((int(w(y, s, t, 0)), int(w(y, s, t, 1))), (r,g,b))
        except:
            pass
blank.save("unwarp.png")

