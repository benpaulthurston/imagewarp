from PIL import Image
Q=[[[250,300],[300,500],[200,700]], [[400,150],[450,400],[350,700]], [[700,100],[700,400],[750,800]]]
def f(s,t,d):
    u=(1/2)*s**2*Q[0][1][d]-s**2*Q[1][1][d]+(1/2)*s**2*Q[2][1][d]+(1/2)*t*Q[1][2][d]-(1/2)*t*Q[1][0][d]+(1/2)*t**2*Q[1][2][d]-t**2*Q[1][1][d]+(1/2)*t**2*Q[1][0][d]-(1/2)*s*Q[0][1][d]+(1/2)*s*Q[2][1][d]+Q[1][1][d]
    -(1/4)*s*t*Q[0][2][d]+(1/4)*s*t*Q[0][0][d]+(1/4)*s*t*Q[2][2][d]-(1/4)*s*t*Q[2][0][d]-(1/4)*t**2*s*Q[0][2][d]+(1/2)*t**2*s*Q[0][1][d]-(1/4)*t**2*s*Q[0][0][d]+(1/4)*t**2*s*Q[2][2][d]
    -(1/2)*t**2*s*Q[2][1][d]+(1/4)*t**2*s*Q[2][0][d]+(1/4)*s**2*t*Q[0][2][d]-(1/4)*s**2*t*Q[0][0][d]-(1/2)*s**2*t*Q[1][2][d]+(1/2)*s**2*t*Q[1][0][d]+(1/4)*s**2*t*Q[2][2][d]-(1/4)*s**2*t*Q[2][0][d]
    +(1/4)*t**2*s**2*Q[0][2][d]-(1/2)*t**2*s**2*Q[0][1][d]+(1/4)*t**2*s**2*Q[0][0][d]-(1/2)*t**2*s**2*Q[1][2][d]+t**2*s**2*Q[1][1][d]-(1/2)*t**2*s**2*Q[1][0][d]+(1/4)*t**2*s**2*Q[2][2][d]-(1/2)*t**2*s**2*Q[2][1][d]
    +(1/4)*t**2*s**2*Q[2][0][d]
    return u
imagein = Image.open("monalisa.png")
imageout = Image.new("RGB", [800,800])
w = imagein.width
h = imagein.height
print(w,h)
for i in range(0, 2*w):
    for j in range(0, 2*h):
        s = (i-2*w/2.0)/w
        t = (j-2*h/2.0)/h
        c=imagein.getpixel((int(i/2.0),int(j/2.0)))
        imageout.putpixel((int(f(s,t, 0)),int(f(s,t,1))), c)
imageout.save("monalisawarped.png")
